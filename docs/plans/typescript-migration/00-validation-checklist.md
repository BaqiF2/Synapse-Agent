# TypeScript 迁移验证清单汇总

**版本**: v1.0
**用途**: 实施过程中的快速验证参考
**状态**: 强制执行

---

## 验证三原则总览

### 1️⃣ 迁移前检查（Pre-Migration Check）
在开始编写 TypeScript 代码之前必须完成：
- 阅读对应的 Python 源码实现
- 理解设计意图和行为细节
- 识别语言差异点

### 2️⃣ 迁移后检查（Post-Migration Check）
在完成代码编写后必须完成：
- 验证功能行为一致性
- 确保字段名、接口对齐
- 测试边界情况和错误处理

### 3️⃣ PRD 符合性检查（PRD Compliance Check）
在每个阶段结束时必须完成：
- 验证核心理念的符合性
- 确保使用场景可执行
- 满足非功能性需求

---

## 第一部分：项目概述与迁移目标

### 迁移前检查
- [ ] 对照 Python 源码：详细阅读对应的 Python 实现，理解每个功能的具体行为
- [ ] 记录功能清单：列出所有需要迁移的功能点、接口、配置项
- [ ] 识别差异点：标记 Python 和 TypeScript 在语言特性上可能产生差异的地方
- [ ] 理解设计意图：确保理解每个设计决策的原因，而非简单翻译代码

### 迁移后检查
- [ ] 功能对齐验证：逐一验证每个功能与 Python 版本的行为一致性
- [ ] 字段名称对齐：确保所有接口、类型、变量名与 Python 版本保持一致
- [ ] 错误处理对齐：验证错误消息、异常类型与 Python 版本相同
- [ ] 边界情况测试：测试空值、异常输入、极限情况的处理是否一致

### PRD 符合性检查
- [ ] 核心理念验证：确保实现符合"统一 Bash 抽象"的核心理念
- [ ] 架构一致性：验证三层 Bash 架构（Base → Agent → Field）完整实现
- [ ] 扩展能力验证：确保支持工具转换、技能加载等自我成长能力
- [ ] 使用场景覆盖：验证 PRD 中定义的核心使用场景可以正常执行

---

## 第二部分：技术栈选型

### 迁移前检查
- [ ] Python 依赖分析：详细列出 Python 版本使用的所有依赖包及其用途
- [ ] 功能映射确认：确认每个 Python 包在 TypeScript 生态中的对应包
- [ ] API 兼容性评估：评估 MiniMax API 通过 Anthropic SDK 的兼容性
- [ ] 运行时特性对比：对比 Python 和 Bun 运行时的差异点

### 迁移后检查
- [ ] 依赖安装验证：确保所有依赖包可以正常安装和使用
- [ ] API 调用测试：验证 MiniMax API 通过 @anthropic-ai/sdk 正常工作
- [ ] 性能基准测试：对比 Python 和 TypeScript 版本的性能指标
- [ ] 兼容性测试：测试所有依赖包的版本兼容性

### PRD 符合性检查
- [ ] 工具抽象能力：验证技术栈支持"一切工具都是 Bash"的抽象能力
- [ ] 扩展性验证：确保技术栈支持工具转换、技能系统等扩展功能
- [ ] CLI 交互体验：验证终端 UI 框架满足 PRD 的交互要求
- [ ] 持久化能力：验证文件系统操作满足"记忆载体"的要求

---

## 第三部分：项目结构设计

### 迁移前检查
- [ ] Python 目录结构分析：详细记录 Python 版本的目录组织方式
- [ ] 模块依赖关系图：绘制 Python 版本各模块间的依赖关系
- [ ] 命名规范对照：对比 Python 和 TypeScript 的命名习惯差异
- [ ] 导入导出机制：理解 Python 和 TypeScript 的模块系统差异

### 迁移后检查
- [ ] 目录结构对照：逐一对照 TypeScript 和 Python 的目录结构
- [ ] 模块职责验证：确保每个模块的职责与 Python 版本一致
- [ ] 导入路径检查：验证所有模块导入路径正确且符合 ESM 规范
- [ ] 文件命名验证：确保文件命名规范统一且易于查找

### PRD 符合性检查
- [ ] 可扩展性验证：验证目录结构支持工具转换器、技能系统的扩展
- [ ] 分层架构清晰：确保 Base/Agent/Field 三层结构在目录中清晰体现
- [ ] 技能文件系统：验证技能目录结构符合"文件系统是记忆载体"理念
- [ ] 模块化设计：确保每个模块可独立测试和维护

---

## 第四部分：核心模块设计

### 迁移前检查
- [ ] Agent 主循环逻辑：详细阅读 Python `agent.py` 的执行流程和状态管理
- [ ] LLM 交互协议：理解 Python 版本如何调用 Anthropic API 和处理响应
- [ ] 配置管理机制：分析 Python 版本的配置加载、验证、环境变量处理
- [ ] 类型定义对照：对比 Python 类型注解和 TypeScript 类型系统

### 迁移后检查
- [ ] 消息循环验证：验证 Agent 主循环与 Python 版本行为完全一致
- [ ] 工具调用流程：测试工具调用的请求-响应流程与 Python 版本对齐
- [ ] 配置加载测试：验证环境变量、配置文件的加载顺序和优先级
- [ ] 类型安全检查：确保所有类型定义正确且无类型错误

### PRD 符合性检查
- [ ] 唯一工具验证：确认 LLM 只能看到单一 Bash 工具，符合统一抽象理念
- [ ] 对话历史管理：验证对话历史正确维护，支持技能强化的学习能力
- [ ] 系统提示词：确认系统提示词正确传递 Bash 三层架构的使用说明
- [ ] 错误处理机制：验证错误处理支持 Agent 自我修复和学习

---

## 第五部分：工具系统设计

### 迁移前检查
- [ ] BashRouter 解析逻辑：详细阅读 Python `bash_router.py` 的命令解析实现
- [ ] 工具接口定义：理解 Python `BaseTool` 的 `execute(**kwargs)` 接口设计
- [ ] 参数传递机制：分析 Python 如何将命令字符串转换为 kwargs
- [ ] 所有工具实现：逐个阅读 Read/Write/Edit/Grep/Glob 工具的 Python 实现

### 迁移后检查
- [ ] 命令解析验证：测试各种命令格式（--key=value, --key value, 位置参数）的解析
- [ ] 工具执行测试：逐个验证每个工具的功能与 Python 版本完全一致
- [ ] 参数类型转换：验证字符串→数字、布尔值的类型转换正确
- [ ] Help 系统测试：验证 -h 和 --help 输出格式与 Python 版本一致

### PRD 符合性检查
- [ ] 三层 Bash 架构：验证 Base/Agent/Field 三层命令路由正确实现
- [ ] 统一接口验证：确认所有工具通过统一的 Bash 接口调用
- [ ] 工具转换能力：验证架构支持 MCP/FunctionCalling 转换为 Field Bash
- [ ] 扩展性验证：确认新工具可以轻松注册到 ToolRegistry

---

## 第六部分：技能系统设计

### 迁移前检查
- [ ] 技能加载流程：详细阅读 Python `skill_loader.py` 的三层加载机制
- [ ] Frontmatter 解析：理解 Python 如何解析 YAML frontmatter
- [ ] 技能索引机制：分析 Python `skill_index.py` 的索引和持久化实现
- [ ] SKILL.md 格式：确认技能文件的完整格式规范

### 迁移后检查
- [ ] 加载机制验证：测试 loadMetadata/loadSkill/loadFull 三层加载
- [ ] Frontmatter 解析：验证 YAML 解析结果与 Python 版本一致
- [ ] 技能搜索测试：验证按名称、描述、域的搜索功能
- [ ] 持久化验证：测试索引的保存和加载功能

### PRD 符合性检查
- [ ] 文件系统记忆：验证技能通过文件系统持久化，符合"记忆载体"理念
- [ ] 技能自我成长：确认架构支持技能的自动生成和强化
- [ ] 外源技能融合：验证支持外部技能库的导入和融合能力
- [ ] 工具关联机制：确认技能可以关联 scripts 和 references

---

## 第七部分：CLI 层设计

### 迁移前检查
- [ ] CLI 命令对照：详细列出 Python 版本的所有 CLI 命令和选项
- [ ] REPL 交互流程：理解 Python REPL 的命令处理、历史管理机制
- [ ] 输出格式分析：分析 Python 使用 rich 库的输出格式和样式
- [ ] 错误处理流程：理解 Python CLI 的错误捕获和显示方式

### 迁移后检查
- [ ] 命令行为验证：逐个测试每个 CLI 命令的行为与 Python 版本一致
- [ ] REPL 功能测试：验证 REPL 的所有特殊命令（!cmd, /clear, /exit）
- [ ] 输出格式对比：对比 Markdown 渲染、代码高亮的视觉效果
- [ ] Help 输出验证：确认 --help 输出格式和内容与 Python 版本一致

### PRD 符合性检查
- [ ] CLI 交互体验：验证 CLI 提供流畅的交互体验，符合验证期用户需求
- [ ] Bash 直接执行：确认 REPL 支持 `!command` 直接执行 Bash 命令
- [ ] 对话历史维护：验证 REPL 正确维护对话历史，支持技能学习
- [ ] 可扩展性设计：确认 CLI 设计为未来 GUI/API 集成留有空间

---

## 第八部分：实施计划与验证

### 迁移前检查
- [ ] 完整功能清单：基于 Python 源码创建完整的功能清单和验收标准
- [ ] 测试用例收集：收集 Python 版本的所有测试用例作为验证基准
- [ ] 性能基准记录：记录 Python 版本的性能指标（启动时间、执行速度）
- [ ] 依赖关系图：绘制模块间的依赖关系，确定实施顺序

### 迁移后检查
- [ ] 功能回归测试：执行完整的功能回归测试套件
- [ ] 性能对比测试：对比 TypeScript 和 Python 版本的性能指标
- [ ] 端到端测试：执行 PRD 中定义的所有使用场景
- [ ] 文档完整性检查：确保所有文档、注释、README 完整准确

### PRD 符合性检查

#### 核心理念验证矩阵
- [ ] 统一抽象层：一切工具通过 Bash 调用
- [ ] 功能即工具：所有扩展通过工具实现
- [ ] 智能涌现：技能+LLM 产生学习能力
- [ ] 沙盒定位：作为工程实现的工作台

#### 使用场景完整覆盖
- [ ] 场景一：技能从零到有（自动生成技能）
  - [ ] Agent 首次执行任务无技能
  - [ ] 任务完成后自动生成技能文件
  - [ ] 下次执行相同任务直接加载技能

- [ ] 场景二：技能持续强化（优化工具调用）
  - [ ] Agent 多次执行类似任务
  - [ ] 技能质量指标持续提升
  - [ ] 工具调用顺序和参数优化

- [ ] 场景三：外源技能融合（导入外部技能）
  - [ ] 导入外部技能库
  - [ ] 自动分析技能适用场景
  - [ ] 完成技能融合和优化

- [ ] 场景四：工具转换为 Bash（MCP/FC/Skills 转换）
  - [ ] MCP 工具自动转换为 Field Bash
  - [ ] FunctionCalling 工具自动转换
  - [ ] Skills 脚本自动转换

#### 非功能性需求
- [ ] 响应时间：简单查询 < 2s
- [ ] 并发能力：支持多个 Agent 实例
- [ ] 资源占用：内存 < 500MB
- [ ] 错误率：< 5%

---

## 验证记录模板

为每个验证项创建记录：

```markdown
### 验证项：[验证项名称]

**验证日期**：YYYY-MM-DD
**验证人员**：[姓名]
**验证结果**：✅ 通过 / ❌ 未通过

**验证详情**：
- 测试用例：[具体测试内容]
- 预期结果：[预期行为]
- 实际结果：[实际行为]
- 差异说明：[如有差异，详细说明]

**遗留问题**：
- [问题1]
- [问题2]

**签署**：___________
```

---

## 验证流程图

```
┌─────────────────────┐
│  选择实施阶段        │
└──────────┬──────────┘
           ▼
┌─────────────────────┐
│  执行迁移前检查      │
│  □ 阅读 Python 代码 │
│  □ 理解设计意图      │
│  □ 识别差异点        │
└──────────┬──────────┘
           ▼
     全部通过？
           │
          是▼              否→ 返回补充分析
┌─────────────────────┐
│  开始编写 TS 代码    │
└──────────┬──────────┘
           ▼
┌─────────────────────┐
│  执行迁移后检查      │
│  □ 功能对齐验证      │
│  □ 字段名称对齐      │
│  □ 边界情况测试      │
└──────────┬──────────┘
           ▼
     全部通过？
           │
          是▼              否→ 返回修复代码
┌─────────────────────┐
│  执行 PRD 符合性检查 │
│  □ 核心理念验证      │
│  □ 使用场景测试      │
│  □ 非功能性验证      │
└──────────┬──────────┘
           ▼
     全部通过？
           │
          是▼              否→ 返回调整实现
┌─────────────────────┐
│  进入下一阶段        │
└─────────────────────┘
```

---

## 快速参考

### 关键对齐点

| 对齐项 | Python | TypeScript | 验证方法 |
|--------|--------|-----------|----------|
| 字段名 | snake_case | snake_case | 代码审查 |
| 工具接口 | execute(**kwargs) | execute(kwargs) | 单元测试 |
| 返回类型 | ToolResult | ToolResult | 类型检查 |
| 命令解析 | shlex.split | shell-quote | 集成测试 |
| offset 索引 | 1-indexed | 1-indexed | 功能测试 |

### PRD 核心要求速查

- ✅ 三层 Bash 架构（Base/Agent/Field）
- ✅ 唯一工具设计（LLM 只看到 bash 工具）
- ✅ 技能自我成长（自动生成、强化、融合）
- ✅ 工具统一抽象（MCP/FC/Skills → Bash）
- ✅ 文件系统记忆（技能和知识持久化）

---

**最后提醒**：
- 🚫 严禁跳过任何验证步骤
- 🚫 未通过验证不得进入下一阶段
- ✅ 所有验证必须有书面记录
- ✅ 疑问必须与 PRD 作者澄清
